---
title: Notes and code examples to accompany "If the Null Fits, You Must Omit"
author: Matt Turner · [https://mat.phd](https://mat.phd)
date: today
toc: true
editor: 
  markdown: 
    wrap: 90
bibliography: this.bib
---

### Purpose: demonstrate gp-stats codebase

Here are some quick notes on the group polarization codebase in R supporting our article,
*If the Null Fits, You Must Omit*. The code is permanently [hosted on
GitHub](https://github.com/mt-digital/gp-statmod/tree/final-draft/GroupPolarizationStatmod).

To follow along, please clone the `gp-statmod` directory.

```         
$ git clone https://github.com/mt-digital/gp-statmod.git
```

Change directories to go to the `paper` directory where this document lives:

```         
cd gp-statmod/GroupPolarizationStatmod/paper
```

Then you can run the examples in this document, edit them, etc., on your own computer.

# Simulations

I developed two models of group polarization to serve complementary purposes.

## Expectation model of group polarization experiments

See Method section of the paper where we explain how to calculate the probability density
vector representing the probability that a participant gives the opinion represented by
each measurement bin, $b$.

Here we show how to calculate the mean observed opinion at pre- and post-discussion to
show how spurious group polarization occurs under a null polarization hypothesis.

@Moscovici1969 report observing a mean opinion of -0.6 in pre-discussion opinions and mean
opinion -1.04 post-discussion, measured using an ordinal scale from -3 (strongly disagree)
to +3 (strongly agree). Let's calculate the probability density vector for the pre- and
post-discussion distributions then calculate the mean opinion for each one. The latent
distributions have the same mean, -1.2, but different variances, which results in a
shifted observed mean due to opinion clipping.

![](images/clipboard-1443885641.png){width="628"}

We call this a *null polarization model* (defined in terms of latent opinions) that
generates *spurious group polarization.* *Spurious group polarization* is when the
observed opinion distributions appear to polarize (i.e., *radicalize*, or *become more
extreme*) that does not represent the true change in latent opinions. The measurement
procedure *clips* extreme opinions less than the minimum bin value, or greater than the
maximum, causing the average observed opinion to *spuriously* appear polarized.

Let's use some modeling code from the repository to demonstrate. For this part we need to
source (*use code from*) the `model.R` file that has the the
[`binProb`](https://github.com/mt-digital/gp-statmod/blob/final-draft/GroupPolarizationStatmod/model.R#L7)
function I use below. Also make sure you have set the working directory to the
`GroupPolarizationStatmod` directory within the `gp-stats` project/repository directory.

For a preliminary step, adapt my code below for your computer. Change the argument to
`root.dir` to be the location of the `GroupPolarizationStatmod` directory on your own
computer.

Now in the following chunk, the `source` function will know where to look for the file
with the `makeProbVec` function we need, `model.R`.

```{r warning=FALSE}
# This is how I set the working directory
# Adapt for your own computer
setwd("~/workspace/gp-statmod/GroupPolarizationStatmod/")
# Load makeProbVec from file model.R
source("model.R")
```

Now read in the pre- and post-discussion means from `Moscovici1969_Americans`

```{r}
# Experimental means
mosc1969_ave_pre <- -0.6
mosc1969_ave_post <- -1.04
```

Create a hypothesized null model that will spuriously look like polarization, with the
same pre- and post-discussion means above. These correspond to $\mu$,
$\sigma_\mathrm{pre}$, and $\sigma_\mathrm{post}$ from the paper that define a null
polarization model, $\nu = (\mu, \sigma_\mathrm{pre}, \sigma_\mathrm{post})$.

```{r}
# Hypothesized null model that looks polarized
mu <- -1.2
sd_pre <- 4.3
sd_post <- 1.9
```

The function `makeProbVec` creates the vector $f[b]$ of probabilities that bin $b_i \in b$
will be reported by a randomly-selected participant, given the measurement bin values and
the distribution of latent opinions, assumed normal, defined by the mean and standard
deviation, $\mu$ and $\sigma$. and bin values. Here bin values are $b=-3,-2,\ldots,3$;
$\mu=-1.2$; and $\sigma=4.3$.

```{r}
# Vector w/ probability density for each bin
f_pre <- makeProbVec(-3:3, -1.2, 4.3)
# Print to two significant digits
sprintf("%.2f", f_pre)
```

Let's `barplot` to have a look:

```{r out.width=500}
barplot(f_pre, 
        names.arg = -3:3,
        ylim = c(0, 0.4),
        ylab = "Pct. Responding",
        xlab = "Bin Value")
```

Let's check the simulated average observed opinion, $\bar{o}$, using the expected value of
the distribution, i.e., we assume $\bar{o} = \langle o \rangle$, so we use the standard
formula for expected value, which assumes that $f[b]$ is normalized.

$$
\bar{o} = \sum_{b=b_1}^{b_B} b \cdot f[b].
$$

In code,

```{r}
# Calculate simulated and compare with actual
sim_obs_pre <- sum((-3:3) * f_pre)
print(abs(sim_obs_pre - mosc1969_ave_pre))
```

This is within one significant digit greater than the reporting scale, meaning it is an
acceptable fit.

This shows that even just a little spread in the distribution of latent opinions results
in a seriously distorted mean [@Liddell2018]—one that reproduces the mean reported by
@Moscovici1969, but actually confirming the null polarization hypothesis!

Let's check the simulated average observed opinion for post-deliberation, repeating the
previous steps for $t=\mathrm{post}$.

```{r}
f_post <- makeProbVec(-3:3, mu, sd_post)
sprintf("%.2f", f_post)
# Calculate simulated and compare with actual
sim_obs_post <- sum((-3:3) * f_post)
print(abs(sim_obs_post - mosc1969_ave_post))
```

Here we get even closer agreement between the observed post-discussion average opinion in
@Moscovici1969 and the one we simulated.
